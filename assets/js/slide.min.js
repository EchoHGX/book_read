$.fn.touchSlider=function(a){a.supportsCssTransitions=function(a){var c,d,b=["Webkit","Moz","Ms"];for(c=0,d=b.length;d>c;c++)if("undefined"!=typeof a[b[c]+"Transition"])return!0;return!1}(document.createElement("div").style),a=$.extend({roll:!0,flexible:!1,btn_prev:null,btn_next:null,paging:null,speed:75,view:1,range:.15,page:1,transition:!1,initComplete:null,counter:null,multi:!1},a);var b=[];return b=$.extend({},$.fn.touchSlider.defaults,a),this.each(function(){$.extend(this,touchSlider);var a=this;this.opts=b,this._view=this.opts.view,this._speed=this.opts.speed,this._tg=$(this),this._list=this._tg.children().children(),this._width=parseInt(this._tg.css("width")),this._item_w=parseInt(this._list.css("width")),this._len=this._list.length,this._range=this.opts.range*this._width,this._pos=[],this._start=[],this._startX=0,this._startY=0,this._left=0,this._top=0,this._drag=!1,this._scroll=!1,this._btn_prev="",this._btn_next="",this.init(),$(this).bind("touchstart",this.touchstart).bind("touchmove",this.touchmove).bind("touchend",this.touchend).bind("dragstart",this.touchstart).bind("drag",this.touchmove).bind("dragend",this.touchend),$(window).bind("orientationchange resize",function(){a.resize(a)})})};var touchSlider={init:function(){var b,c,a=this;for($(this).children().css({width:this._width+"px",overflow:"visible"}),this.opts.flexible&&(this._item_w=this._width/this._view),this.opts.roll&&(this._len=Math.ceil(this._len/this._view)*this._view),b=this.opts.page>1&&this.opts.page<=this._len?(this.opts.page-1)*this._item_w:0,c=0;c<this._len;++c)this._pos[c]=this._item_w*c-b,this._start[c]=this._pos[c],this._list.eq(c).css({position:"absolute",top:"0",left:this._pos[c]+"px"}),this.opts.supportsCssTransitions&&this.opts.transition&&this._list.eq(c).css({"-moz-transition":"0ms","-moz-transform":"","-ms-transition":"0ms","-ms-transform":"","-webkit-transition":"0ms","-webkit-transform":"",transition:"0ms",transform:""});this.opts.btn_prev&&this.opts.btn_next&&(this.opts.btn_prev.bind("click",function(){return a.animate(1,!0),!1}),this.opts.btn_next.bind("click",function(){return a.animate(-1,!0),!1})),this.opts.paging&&$(this._list).each(function(b){var d=a.opts.paging.eq(b);d.bind("click",function(c){return a.go_page(b,c),!1})}),this.counter(),this.initComplete()},initComplete:function(){"function"==typeof this.opts.initComplete&&this.opts.initComplete(this)},resize:function(a){var b,c;if(a.opts.flexible)for(b=a._item_w,a._width=parseInt(a._tg.css("width")),a._item_w=a._width/a._view,a._range=a.opts.range*a._width,c=0;c<a._len;++c)a._pos[c]=a._pos[c]/b*a._item_w,a._start[c]=a._start[c]/b*a._item_w,a._list.eq(c).css({left:a._pos[c]+"px",width:a._item_w+"px"}),this.opts.supportsCssTransitions&&this.opts.transition&&a._list.eq(c).css({"-moz-transition":"0ms","-moz-transform":"","-ms-transition":"0ms","-ms-transform":"","-webkit-transition":"0ms","-webkit-transform":"",transition:"0ms",transform:""});this.counter()},touchstart:function(a){this._startX=a.pageX||a.touches[0].clientX,this._startY=a.pageY||a.touches[0].clientY,this._scroll=!1,this._start=[];for(var b=0;b<this._len;++b)this._start[b]=this._pos[b]},touchmove:function(a){var b,c,d,e,f;for(this._left=(a.pageX||a.touches[0].clientX)-this._startX,this._top=(a.pageY||a.touches[0].clientY)-this._startY,b=this._left<0?-1*this._left:this._left,c=this._top<0?-1*this._top:this._top,c>b||this._scroll?(this._left=0,this._drag=!1,this._scroll=!0):(a.preventDefault(),this._drag=!0,this._scroll=!1,this.position(a)),d=0;d<this._len;++d)e=this._start[d]+this._left,this.opts.supportsCssTransitions&&this.opts.transition?(f="translate3d("+e+"px,0,0)",this._list.eq(d).css({left:"","-moz-transition":"0ms","-moz-transform":f,"-ms-transition":"0ms","-ms-transform":f,"-webkit-transition":"0ms","-webkit-transform":f,transition:"0ms",transform:f})):this._list.eq(d).css("left",e+"px"),this._pos[d]=e},touchend:function(){return this._scroll?(this._drag=!1,this._scroll=!1,!1):(this.animate(this.direction()),this._drag=!1,this._scroll=!1,void 0)},position:function(a){var c,d,e,f,g,b=this._view*this._item_w;if(-1==a||1==a){for(this._startX=0,this._start=[],c=0;c<this._len;++c)this._start[c]=this._pos[c];this._left=a*b}else this._left>b&&(this._left=b),this._left<-b&&(this._left=-b);if(this.opts.roll){for(d=[],c=0;c<this._len;++c)d[c]=this._pos[c];if(d.sort(function(a,b){return a-b}),e=d[this._len-this._view],f=$.inArray(d[0],this._pos),g=$.inArray(e,this._pos),this._view<=1&&(e=this._len-1),this.opts.multi){if(1==a&&d[0]>=0||this._drag&&d[0]>=100)for(c=0;c<this._view;++c,++f,++g)this._start[g]=this._start[f]-b,this._list.eq(g).css("left",this._start[g]+"px");else if(-1==a&&d[0]<=0||this._drag&&d[0]<=-100)for(c=0;c<this._view;++c,++f,++g)this._start[f]=this._start[g]+b,this._list.eq(f).css("left",this._start[f]+"px")}else if(1==a&&d[0]>=0||this._drag&&d[0]>0)for(c=0;c<this._view;++c,++f,++g)this._start[g]=this._start[f]-b,this._list.eq(g).css("left",this._start[g]+"px");else if(-1==a&&d[e]<=0||this._drag&&d[e]<=0)for(c=0;c<this._view;++c,++f,++g)this._start[f]=this._start[g]+b,this._list.eq(f).css("left",this._start[f]+"px")}else this.limit_chk()&&(this._left=this._left/2)},animate:function(a,b){var c,d,e;(this._drag||!this._scroll||b)&&(c=this,d=this._speed,b&&this.position(a),e=a*this._item_w*this._view,(0==this._left||!this.opts.roll&&this.limit_chk())&&(e=0),this._list.each(function(a){var g,h;c._pos[a]=c._start[a]+e,c.opts.supportsCssTransitions&&c.opts.transition?(g=d+"ms",h="translate3d("+c._pos[a]+"px,0,0)",b&&(g="0ms"),$(this).css({left:"","-moz-transition":g,"-moz-transform":h,"-ms-transition":g,"-ms-transform":h,"-webkit-transition":g,"-webkit-transform":h,transition:g,transform:h})):$(this).animate({left:c._pos[a]+"px"},d)}),this.counter())},direction:function(){var a=0;return this._left<-this._range?a=-1:this._left>this._range&&(a=1),(!this._drag||this._scroll)&&(a=0),a},limit_chk:function(){var a=parseInt((this._len-1)/this._view)*this._view;return 0==this._start[0]&&this._left>0||0==this._start[a]&&this._left<0},go_page:function(a){for(var c=$.inArray(0,this._pos)/this._view+1,d=c-(a+1);0!=d;)0>d?(this.animate(-1,!0),d++):d>0&&(this.animate(1,!0),d--)},counter:function(){if("function"==typeof this.opts.counter){var a={total:Math.ceil(this._len/this._view),current:$.inArray(0,this._pos)/this._view+1};this.opts.counter(a)}}};